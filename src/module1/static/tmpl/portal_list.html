<div ng-show="loading" flex layout="row" layout-sm="column"  layout-align="center center">
  <md-progress-circular class="md-hue-2" md-mode="indeterminate"></md-progress-circular>
</div>
<div ng-if="!loading && !viewMap && !viewPortal" layout-fill flex ng-cloak class="ng-cloak">
  <md-toolbar md-scroll-shrinkz>
    <div class="md-toolbar-tools" layout="row" layout-align="center center">
      <form name="userForm" layout="row">
        <md-input-container flex>
          <input type="search" style="background-color: white;" ng-model="labels">
        </md-input-container>
        <md-button aria-label="" ng-click="labels = null" style="height:34px;" class="icon-content-white icon-content-white-ic_clear_white_24dp" ng-show="labels">
        </md-button> 
        <md-button aria-label="" ng-click="searchPortal(labels)" style="height:34px;" class="icon-action-white icon-action-white-ic_search_white_24dp">
        </md-button> 
      </form>
    </div>
  </md-toolbar>
  <md-content style="heightz: {{device_screen_data.availHeight}}px; margin-bottom: 60px;">
    <h1 ng-if="items.length == 0"> No hay portales, agrega m√°s.</h1>
    <md-list>
      <md-item ng-repeat="item in items">
        <md-item-content layout="row" ng-class="{'linkable_portal':true,  'linkable_portal_selected':selected_portals_to_link.indexOf(item.title) != -1}">
          <div class="md-tile-left" hide-sm>
            <img ng-src="{{item.image}}" class="face">
          </div>
          <div class="md-tile-content" layout="column" layout-align="center start">
            <portal-list-portal-title click="showPortal(item)" portal-info="item"></portal-list-portal-title>
            <md-list layout="row" ng-if="item.keys">
              <md-item ng-repeat="key in item.keys | orderBy:'count':true">
                <md-item-content>
                  <md-button><span style="font-style: italic;">@{{key.agentKey}} ({{key.amount}})&nbsp;</span></md-button></md-item-content>
              </md-item>
            </md-list>
            <md-list layout="row" ng-if="item.labels">
              <md-item ng-repeat="label in item.labels">
                <md-item-content class="md-accent">
                  <md-button aria-label="" ng-click="searchPortal(label)">#{{label}}&nbsp;</md-button>
                </md-item-content>
              </md-item>
            </md-list>
          </div>
          <md-button aria-label="" ng-click="showPortalSecondaryActionsBottomSheet(item)" class="icon-navigation-grey600 icon-navigation-grey600-ic_more_vert_grey600_24dp" hide-gt-md>
              <md-tooltip>Acciones</md-tooltip>
          </md-button> 
          <md-whiteframe style="max-width: 200px;" class="background_intel_ingress md-whiteframe-z1" layout="row" flex layout-align="space-around center" hide show-gt-md>
            <md-button aria-label="" ng-click="toggleLinkable(item)">
              <img src="/img/map_icons/linkclearicon.png">
              <md-tooltip>Simular linkeo</md-tooltip>
            </md-button> 
            <md-button aria-label="" ng-href="https://www.ingress.com/intel?z=13&pll={{item.lat/1000000}},{{item.lon/1000000}}&pls={{ intel_pls }}" target="_blank">
              <div class="SPRITE_maplink header_icon"></div>
              <md-tooltip>Intel</md-tooltip>
            </md-button>
            <md-button aria-label="" ng-click="showMap(item)">
              <div class="img_snap header_icon"></div>
              <md-tooltip>Mapa</md-tooltip>
            </md-button>
          </md-whiteframe>
        </md-item-content>
        <md-item-content id="inset_{{$index}}">
        </md-item-content>
        <md-divider ng-if="!$last"></md-divider>
      </md-item>
    </md-list>
    <md-button ng-href="/portals/add" class="md-primary md-fab md-fab-bottom-right" aria-label="Add Portal">
      <div class="icon-content-white icon-content-white-ic_add_white_24dp gogress-fab"></div>
    </md-button> 
  </md-content>
</div>
<div ng-if="viewMap && !viewPortal" layout-fill>
  <div layout="column" flex>
    <md-button aria-label="" ng-click="hideMap()">Cerrar</md-button>
    <div flex>
      <ui-gmap-google-map center="map.center" zoom="map.zoom" draggable="true" options="options" bounds="map.bounds">
      <ui-gmap-markers models="markers" coords="'self'" icon="'icon'">
      </ui-gmap-markers>
      </ui-gmap-google-map>
    </div>
  </div>
</div>
<div ng-if="viewPortal" style="min-width:100%;">
  <portal-view></portal-view>
</div>
